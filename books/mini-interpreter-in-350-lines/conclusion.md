---
title: "おわりに"
---

いかがでしたか？

インクリメンタルに作っていくところを追体験するような感じで読めれば、と思ってこのスタイルに挑戦してみたのですが、完成形を見越してあらかじめ書いておかないと書き直しが増えることと、あまり先読みで書いてしまってはインクリメンタルな感じがでなくなりそうなのとでバランスが難しく感じていました。

なんとなくわかった気がした、ちょっといじってみよう、できそうな気がする、と思ってもらえれば望外の喜びです。

## これから

すこしいじってみるとより理解が深まるでしょう。
minilangでやりやすそうな拡張としては以下のようなものが考えられます。

* 入出力を充実させる。
  改行しない版のprintを作ったりひとつのprintで複数の式を出力できるようにしたり、キーボードからの入力を受け付けたり、ファイルに出力してみたりできるようにする。
* ファイルを読んで実行するようにする。
  テストもファイルから実行して結果をチェックする形にできるかもしれません。
* トップレベルからのreturnをエラーにする。
　あまりそういう言語は見かけませんがプログラムからの返り値として扱うことも考えられます。どちらがよい仕様だと思いますか？
　OSが255までしか受け付けないからでしょうか。
* 関数呼び出しの引数の数が合わなければエラーにする。
　組み込み関数は？
* コメントを書けるようにする。
  Scannerでコメントを見つけたら読み飛ばすようにしてしまえばParser以降は影響を受けません。
  コメントをあらわす文字には"!"なんてどうでしょうか。
* 初期値を省略できるようにする。
  nullがあればnullを入れるところですがないので省略したときの値には0を入れておきます。
  nullを作ってからやるのもいいでしょう。
* 真偽値や関数の計算・比較をエラーにする。
  真偽値の+はor、*をandとして扱うのもありでしょう。
* 比較演算子を追加する。
  `<`、`>`はすぐできます。
　2文字の演算子を追加したくなったらScannerを修正する必要があります。
　`<`を見ただけではそれが`<`なのか、`<=`の1文字目なのかわからないので、もう1文字見てみる必要があります。
* 単項マイナスを実装する。
  "-123"という文字列を見たとき、符号が付いた数として字句解析で処理する方法と、符号を変えるマイナス演算子の後に123が来たものとして構文解析で扱う方法があります。
* and, orを実装する。
  構文解析は左結合の二項演算子と同様ですが、評価時にはショートカットがあることに注意してください。
* 三項演算子（`?:`）を実装する。
  and, orと似てますが右結合であることに気を付けて。
* break文、continue文を実装する。
  returnと同様な方法で実現可能です。
* whileにthenを書けるようにする。
  breakせずにwhileを終了したら、then以下を実行するようにします。
  pythonのwhile - elseと同じです[^while-else]。
  [^while-else]: なんかあんまり評判がよくないんですが自分はけっこう好きです。フラグを付けて管理するよりはよっぽどいい。elseじゃなくてthenだったらそんなに不評にならなかったのではという気もする（breakしたらelseってしてもよさそう）。英語話者ではないのでわかりませんが。
* `for`を実装する。
  これも、文の先頭で`for`を見つけたら`while`の形に読み直してASTを作ればOKです。
  `for (;;)`はminilangの構文とはあんまり相性がよくないかも？
  `for a = 0; a # 5; a = a + 1 { print a; }`
  省略を許すとかいろいろやろうとするとその分複雑になります。
  シンタックスシュガー方式ではcontinueが作れない！
* null/Noneを作る。
  minilangでは予約語のチェックみたいなことをしていないので、Scanner・Parserは修正するところはありません（変数と同じ扱いで十分）。
  Scannerで名前を読むところで、名前が"null"だったらPythonのNoneを返すようにします。
  Parser・Evaluatorで"null"を発見したら適宜処理。
  あとは表示とか（するなら）計算時の型チェックとかも。
  変数初期化やreturnの値を省略したときの値としてnullを使いましょう。
  初期値を設定しないまま参照してしまったときにはエラーにしますか？nullが入っているものとして続行しますか？

わかった気がしたら、一から自分で書いてみるのをおすすめしたいです。
小さく作ったのはそういう意味もあります。
350行なら自分で書いてみるか、っていう気にもなりやすいかと。
私も何度か書いてみてやっと頭がすっきりした気がしました。
（逆に言えばそれまではすっきり理解できた気がしていなかった）
そのときのうれしさをほかのひとにも味わってもらえたら、というのがこの本を書いてみた動機のひとつとなっています。

そこまでやったら十分にもっと本格的な言語処理系の勉強に進む準備ができていると思います。
比較的簡単なインタプリタなら「ああここではあのへんの処理をやってるんだな」と理解しながら進めると思います。
もちろん新たに出てくる話もあるのでそのあたりは新たにお勉強です。
コンパイラは私もこれからお勉強。

では、たのしい言語処理系ライフを！